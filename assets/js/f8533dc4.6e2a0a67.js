"use strict";(self.webpackChunkguardian=self.webpackChunkguardian||[]).push([[786],{3905:function(e,r,n){n.d(r,{Zo:function(){return c},kt:function(){return m}});var t=n(7294);function a(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function i(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function o(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?i(Object(n),!0).forEach((function(r){a(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function l(e,r){if(null==e)return{};var n,t,a=function(e,r){if(null==e)return{};var n,t,a={},i=Object.keys(e);for(t=0;t<i.length;t++)n=i[t],r.indexOf(n)>=0||(a[n]=e[n]);return a}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)n=i[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=t.createContext({}),u=function(e){var r=t.useContext(s),n=r;return e&&(n="function"==typeof e?e(r):o(o({},r),e)),n},c=function(e){var r=u(e.components);return t.createElement(s.Provider,{value:r},e.children)},p={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},d=t.forwardRef((function(e,r){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(n),m=a,v=d["".concat(s,".").concat(m)]||d[m]||p[m]||i;return n?t.createElement(v,o(o({ref:r},c),{},{components:n})):t.createElement(v,o({ref:r},c))}));function m(e,r){var n=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var s in r)hasOwnProperty.call(r,s)&&(l[s]=r[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var u=2;u<i;u++)o[u]=n[u];return t.createElement.apply(null,o)}return t.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5162:function(e,r,n){n.d(r,{Z:function(){return o}});var t=n(7294),a=n(6010),i="tabItem_Ymn6";function o(e){let{children:r,hidden:n,className:o}=e;return t.createElement("div",{role:"tabpanel",className:(0,a.Z)(i,o),hidden:n},r)}},5488:function(e,r,n){n.d(r,{Z:function(){return m}});var t=n(3117),a=n(7294),i=n(6010),o=n(2389),l=n(7392),s=n(7094),u=n(2466),c="tabList__CuJ",p="tabItem_LNqP";function d(e){var r,n;const{lazy:o,block:d,defaultValue:m,values:v,groupId:y,className:g}=e,f=a.Children.map(e.children,(e=>{if((0,a.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),b=null!=v?v:f.map((e=>{let{props:{value:r,label:n,attributes:t}}=e;return{value:r,label:n,attributes:t}})),h=(0,l.l)(b,((e,r)=>e.value===r.value));if(h.length>0)throw new Error('Docusaurus error: Duplicate values "'+h.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.');const k=null===m?m:null!=(r=null!=m?m:null==(n=f.find((e=>e.props.default)))?void 0:n.props.value)?r:f[0].props.value;if(null!==k&&!b.some((e=>e.value===k)))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+k+'" but none of its children has the corresponding value. Available values are: '+b.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");const{tabGroupChoices:w,setTabGroupChoices:N}=(0,s.U)(),[E,C]=(0,a.useState)(k),O=[],{blockElementScrollPositionUntilNextRender:T}=(0,u.o5)();if(null!=y){const e=w[y];null!=e&&e!==E&&b.some((r=>r.value===e))&&C(e)}const j=e=>{const r=e.currentTarget,n=O.indexOf(r),t=b[n].value;t!==E&&(T(r),C(t),null!=y&&N(y,String(t)))},P=e=>{var r;let n=null;switch(e.key){case"ArrowRight":{var t;const r=O.indexOf(e.currentTarget)+1;n=null!=(t=O[r])?t:O[0];break}case"ArrowLeft":{var a;const r=O.indexOf(e.currentTarget)-1;n=null!=(a=O[r])?a:O[O.length-1];break}}null==(r=n)||r.focus()};return a.createElement("div",{className:(0,i.Z)("tabs-container",c)},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":d},g)},b.map((e=>{let{value:r,label:n,attributes:o}=e;return a.createElement("li",(0,t.Z)({role:"tab",tabIndex:E===r?0:-1,"aria-selected":E===r,key:r,ref:e=>O.push(e),onKeyDown:P,onFocus:j,onClick:j},o,{className:(0,i.Z)("tabs__item",p,null==o?void 0:o.className,{"tabs__item--active":E===r})}),null!=n?n:r)}))),o?(0,a.cloneElement)(f.filter((e=>e.props.value===E))[0],{className:"margin-top--md"}):a.createElement("div",{className:"margin-top--md"},f.map(((e,r)=>(0,a.cloneElement)(e,{key:r,hidden:e.props.value!==E})))))}function m(e){const r=(0,o.Z)();return a.createElement(d,(0,t.Z)({key:String(r)},e))}},1794:function(e,r,n){n.r(r),n.d(r,{assets:function(){return c},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return p}});var t=n(3117),a=(n(7294),n(3905)),i=n(5488),o=n(5162);const l={},s="Create a provider",u={unversionedId:"guides/create-provider",id:"guides/create-provider",title:"Create a provider",description:"We are going to register a Google Cloud Bigquery provider with a dataset named Playground in this example.",source:"@site/docs/guides/create-provider.md",sourceDirName:"guides",slug:"/guides/create-provider",permalink:"/guardian/docs/guides/create-provider",draft:!1,editUrl:"https://github.com/odpf/guardian/edit/master/docs/docs/guides/create-provider.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Create a policy",permalink:"/guardian/docs/guides/create-policy"},next:{title:"Update resource",permalink:"/guardian/docs/guides/update-resource"}},c={},p=[{value:"Pre-Requisites",id:"pre-requisites",level:3},{value:"Example Provider Configuartion",id:"example-provider-configuartion",level:3},{value:"Registering the BigQuery Provider",id:"registering-the-bigquery-provider",level:3},{value:"Providers can be created in the following ways:",id:"providers-can-be-created-in-the-following-ways",level:4}],d={toc:p};function m(e){let{components:r,...n}=e;return(0,a.kt)("wrapper",(0,t.Z)({},d,n,{components:r,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"create-a-provider"},"Create a provider"),(0,a.kt)("p",null,"We are going to register a Google Cloud Bigquery provider with a dataset named ",(0,a.kt)("inlineCode",{parentName:"p"},"Playground")," in this example."),(0,a.kt)("h3",{id:"pre-requisites"},"Pre-Requisites"),(0,a.kt)("p",null,"A service account with ",(0,a.kt)("inlineCode",{parentName:"p"},"roles/bigquyer.dataOwner")," role granted to the Google cloud project. Encode the Service Account key in the base 64 format, get the project id from the BigQuery Project you've created and provide the details in the ",(0,a.kt)("inlineCode",{parentName:"p"},"Credentials")," object given below."),(0,a.kt)("h3",{id:"example-provider-configuartion"},"Example Provider Configuartion"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"type: bigquery\nurn: my-first-bigquery-provider\ncredentials:\n  resource_name: projects/<<my-bq-project-id>> # projects/<<gcp project id>>\n  service_account_key: <<base-64 encoded service account key json>> # Encode the service account key in base 64 form\nresources:\n  - type: table\n    policy:\n      id: my-first-policy\n      version: 1\n    roles:\n      - id: viewer\n        name: Viewer\n        permissions:\n          - roles/bigquery.dataViewer\n      - id: editor\n        name: Editor\n        permissions:\n          - roles/bigquery.dataViewer\n      - id: owner\n        name: Owner\n        permissions:\n          - roles/bigquery.dataOwner\n  - type: dataset\n    policy:\n      id: my-first-policy\n      version: 1\n    roles:\n      - id: viewer\n        name: Viewer\n        permissions:\n          - READER\n      - id: editor\n        name: Editor\n        permissions:\n          - WRITER\n      - id: owner\n        name: Owner\n        permissions:\n          - OWNER\n")),(0,a.kt)("p",null,"Check ",(0,a.kt)("a",{parentName:"p",href:"/guardian/docs/providers/bigquery"},"BigQuery")," provider reference for more details."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Explanation for this Provider Configuration"),(0,a.kt)("br",null)),(0,a.kt)("p",null,"Here we are registering the Bigquery provider with the Service account credentials. These credentials are used by Guardian server to communicate to the provider (in this case is ",(0,a.kt)("inlineCode",{parentName:"p"},"my-bq-project")," bigquery) to retrieve the available resources (table and datasets) as well as managing access to them."),(0,a.kt)("p",null,"Here we are registering a BigQuery Provider with two types of resources ",(0,a.kt)("inlineCode",{parentName:"p"},"Dataset")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"Table")," Each Resource has a policy along with its version attached to it."),(0,a.kt)("p",null,"We have configured the resource type ",(0,a.kt)("inlineCode",{parentName:"p"},"table")," with this policy ",(0,a.kt)("a",{parentName:"p",href:"create-policy#example-policy"},(0,a.kt)("inlineCode",{parentName:"a"},"my-first-policy@1")),". Every appeal created to for this resource type under ",(0,a.kt)("inlineCode",{parentName:"p"},"my-first-bigquery-provider")," provider, will have approval steps according to the policy defined here ",(0,a.kt)("a",{parentName:"p",href:"/guardian/docs/guides/create-policy#example-policy"},(0,a.kt)("inlineCode",{parentName:"a"},"my-first-policy@1")),"."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"Roles")," field is used to define what type of permission a user have, be it ",(0,a.kt)("inlineCode",{parentName:"p"},"Editor"),",",(0,a.kt)("inlineCode",{parentName:"p"},"Viewrer")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"Owner")," in the BigQuery dataset."),(0,a.kt)("p",null,"To check all the available roles for a particular resource type use the API ",(0,a.kt)("inlineCode",{parentName:"p"},"{{HOST}}/api/v1beta1/providers/:id/resources/:resource_type/roles")," with the ",(0,a.kt)("inlineCode",{parentName:"p"},"GET")," Method."),(0,a.kt)("h3",{id:"registering-the-bigquery-provider"},"Registering the BigQuery Provider"),(0,a.kt)("h4",{id:"providers-can-be-created-in-the-following-ways"},"Providers can be created in the following ways:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Using ",(0,a.kt)("inlineCode",{parentName:"li"},"guardian provider create")," CLI command"),(0,a.kt)("li",{parentName:"ol"},"Calling to ",(0,a.kt)("inlineCode",{parentName:"li"},"POST /api/v1beta1/providers")," API")),(0,a.kt)(i.Z,{groupId:"api",mdxType:"Tabs"},(0,a.kt)(o.Z,{value:"cli",label:"CLI",default:!0,mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ guardian provider create --file=provider.yaml\n"))),(0,a.kt)(o.Z,{value:"http",label:"HTTP",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'$ curl --request POST \'{{HOST}}/api/v1beta1/providers\' \\\n--header \'Content-Type: application/json\' \\\n--data-raw \'{\n  "type": "bigquery",\n  "urn": "my-first-bigquery-provider",\n  "credentials": {\n    "service_account_key": "{{base64 encoded service account key json}}",\n    "resource_name": "projects/my-bq-project"\n  },\n  "resources": [\n    {\n      "type": "table",\n      "policy": {\n        "id": "my-first-policy",\n        "version": 1\n      },\n      "roles": [\n        {\n          "id": "viewer",\n          "name": "Viewer",\n          "permissions": [\n            "roles/bigquery.dataViewer"\n          ]\n        },\n        {\n          "id": "editor",\n          "name": "Editor",\n          "permissions": [\n            "roles/bigquery.dataViewer"\n          ]\n        },\n        {\n          "id": "owner",\n          "name": "Owner",\n          "permissions": [\n            "roles/bigquery.dataOwner"\n          ]\n        }\n      ]\n    },\n    {\n      "type": "dataset",\n      "policy": {\n        "id": "my-second-policy",\n        "version": 1\n      },\n      "roles": [\n        {\n          "id": "viewer",\n          "name": "Viewer",\n          "permissions": [\n            "READER"\n          ]\n        },\n        {\n          "id": "editor",\n          "name": "EDITOR",\n          "permissions": [\n            "WRITER"\n          ]\n        },\n        {\n          "id":"owner",\n          "name":"OWNER",\n          "permissions":[\n            "OWNER"\n          ]\n        }\n      ]\n    }\n  ]\n}\'\n')))))}m.isMDXComponent=!0}}]);